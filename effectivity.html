<html>
<meta charset="UTF-8">
<head>
<script type="text/javascript">


// ------------------------------------- JS HELPERS ---------------------------------------------------------
function createElement( type, invars ) {
   var ele = document.createElement(type);
   if (invars != undefined) {
      for (var key in invars) {
         if ( key == "pokemonType" || key == "innerHTML" ) ele[key] = invars[key];
         else ele.setAttribute(key,invars[key]);
      }
   }
   return ele;
}

HTMLElement.prototype.removeFrom = function( arr )
{
   let index = arr.indexOf( this );
   if ( index > -1 )
   {
      arr.splice( index, 1 );
   }
   return this;
}
HTMLElement.prototype.pushTo = function( arr )
{
   arr.push( this );
   return this;
}

// ------------------------------------- PKMN related classes helpers ---------------------------------------

HTMLElement.prototype.pokemonType = "";

const effectivityValueGood = 1.4;
const effectivityValueNeutral = 1;
const effectivityValueBad = 0.71;
const effectivityValueVeryBad = 0.51;

class Type {
   constructor( name, css )
   {
      this.css = css;
      this.name = name;
      this.good = undefined;
      this.bad = undefined;
      this.veryBad = undefined;
   }
   getEffectivityAgainstTarget( target )
   {
      if ( this.good.includes( target ) ) return effectivityValueGood;
      else if ( this.bad.includes( target ) ) return effectivityValueBad;
      else if ( this.veryBad.includes( target ) ) return effectivityValueVeryBad;
      else return effectivityValueNeutral;
   }
   getEffectivityAgainstTargets( targets )
   {
      let effectivity = effectivityValueNeutral;
      for ( t in targets )
      {
         effectivity *= this.getEffectivityAgainstTarget( targets[t] );
      }
      return Math.round( effectivity * 100) / 100;
   }
   setEffectivity( good, bad, veryBad )
   {
      this.good = good;
      this.bad = bad;
      this.veryBad = veryBad;
   }
}

class ComparisonLine
{
   constructor( type, effectivity )
   {
      this.effectivity = effectivity;
      this.types = [type];
   }
   addType( type )
   {
      this.types.push( type );
      return this;
   }
}

class Comparison
{
   constructor( sources, targets )
   {
      this.targets = targets;
      this.lines = [];

      for ( t in sources )
      {
         this.addSource( sources[t] );
      }
   }
   addSource( source )
   {
      console.log(source);
      const effectivity = source.getEffectivityAgainstTargets( this.targets );
      let match = this.lines.filter(function(line){ return line.effectivity == effectivity })[0];
      if ( match )
      {
         match.addType( source );
      }
      else
      {
         this.lines.push( new ComparisonLine( source, effectivity ) );
      }
   }
   getLines()
   {
      return this.lines.sort( function(a,b){ return b.effectivity - a.effectivity });
   }
}

let Bug = new Type("Bug", "bug");
let Dark = new Type("Dark", "dark");
let Dragon = new Type("Dragon", "dragon");
let Electric = new Type("Electric", "electric");
let Fairy = new Type("Fairy", "fairy");
let Fighting = new Type("Fighting", "fighting");
let Fire = new Type("Fire", "fire");
let Flying = new Type("Flying", "flying");
let Ghost = new Type("Ghost", "ghost");
let Grass = new Type("Grass", "grass");
let Ground = new Type("Ground", "ground");
let Ice = new Type("Ice", "ice");
let Normal = new Type("Normal", "normal");
let Poison = new Type("Poison", "poison");
let Psychic = new Type("Psychic", "psychic");
let Rock = new Type("Rock", "rock");
let Steel = new Type("Steel", "steel");
let Water = new Type("Water", "water");

// ----------------------- GOOD ---------------------------------- BAD --------------------------------------------------- VERY BAD ---
Bug.setEffectivity(      [ Dark, Grass, Psychic                ],[ Fairy, Fighting, Fire, Flying, Ghost, Poison, Steel ],[          ]);
Dark.setEffectivity(     [ Ghost, Psychic                      ],[ Dark, Fairy, Fighting                               ],[          ]);
Dragon.setEffectivity(   [ Dragon                              ],[ Steel                                               ],[ Fairy    ]);
Electric.setEffectivity( [ Flying, Water                       ],[ Dragon, Electric, Grass                             ],[ Ground   ]);
Fairy.setEffectivity(    [ Dark, Dragon, Fighting              ],[ Fire, Poison, Steel                                 ],[          ]);
Fighting.setEffectivity( [ Dark, Ice, Normal, Rock, Steel      ],[ Bug, Fairy, Flying, Poison, Psychic                 ],[ Ghost    ]);
Fire.setEffectivity(     [ Bug, Grass, Ice, Steel              ],[ Dragon, Fire, Rock, Water                           ],[          ]);
Flying.setEffectivity(   [ Bug, Fighting, Grass                ],[ Electric, Rock, Steel                               ],[          ]);
Ghost.setEffectivity(    [ Ghost, Psychic                      ],[ Dark                                                ],[ Normal   ]);
Grass.setEffectivity(    [ Ground, Rock, Water                 ],[ Bug, Dragon, Fire, Flying, Grass, Poison,Steel      ],[          ]);
Ground.setEffectivity(   [ Electric, Fire, Poison, Rock, Steel ],[ Bug, Grass                                          ],[ Flying   ]);
Ice.setEffectivity(      [ Dragon, Flying, Grass, Ground       ],[ Fire, Ice, Steel, Water                             ],[          ]);
Normal.setEffectivity(   [                                     ],[ Rock, Steel                                         ],[ Ghost    ]);
Poison.setEffectivity(   [ Fairy, Grass                        ],[ Ghost, Ground, Poison, Rock                         ],[ Steel    ]);
Psychic.setEffectivity(  [ Fighting, Poison                    ],[ Psychic, Steel                                      ],[ Dark     ]);
Rock.setEffectivity(     [ Bug, Fire, Flying, Ice              ],[ Fighting, Ground, Steel                             ],[          ]);
Steel.setEffectivity(    [ Fairy, Ice, Rock                    ],[ Electric, Fire, Steel, Water                        ],[          ]);
Water.setEffectivity(    [ Fire, Ground, Rock                  ],[ Dragon, Grass, Water                                ],[          ]);
// ------------------------------------------------------------------------------------------------------------------------------------

const Types = [ Bug,Dark,Dragon,Electric,Fairy,Fighting,Fire,Flying,Ghost,Grass,Ground,Ice,Normal,Poison,Psychic,Rock,Steel,Water ];

for ( t in Types ) Object.freeze( Types[t] );

// ------------------------------------- executed code ------------------------------------------------------

function createTypeIcon( type )
{
   return createElement(
      "div",
      {  class:"typeIcon "+type.css,
         pokemonType:type,
         innerHTML:type.name
      } );
}

function createComparison( selectedTypes, onlyEffectiveResults )
{
   let comparison = new Comparison( Types, selectedTypes );

   const lines = comparison.getLines();

   let container = createElement( "div",{id:"innerComparisonContainer"} );

   if ( lines.length )
   {
      let left = createElement("div",{class:"comparisonBox"});
      let middle = createElement("div",{class:"comparisonSpacerBox", innerHTML:"&rarr;"});
      let right = createElement("div",{class:"comparisonBox"});
      
      for ( l in lines )
      {
         const line = lines[l];

         let resultLine = createElement("div",{class:"comparisonLine"});
         
         if (  !onlyEffectiveResults
            || line.effectivity > 1 )
	      {
            for ( r in line.types )
            {
               const type = line.types[r];
               resultLine.appendChild( createTypeIcon( type ) );
               resultLine.appendChild( createElement("div",{class:"comparisonLineSpacer"}) );
               
            }
            resultLine.appendChild( createElement("div",{class:"comparisonLineEfficiency",innerHTML:line.effectivity}) );
            resultLine.appendChild( createElement("div",{class:"comparisonLineSpacer"}) );
            left.appendChild( resultLine );
	      }
      }

      for ( s in selectedTypes )
      {
         right.appendChild( createTypeIcon( selectedTypes[s] ) );
      }

      container.appendChild( left );
      container.appendChild( middle );
      container.appendChild( right );
   }
   return container;
}

function updateButtons( selectedButtons, e, dualSelection, showEfficientOnly )
{
   const element = (e.currentTarget) ? e.currentTarget : e.srcElement;

   if ( selectedButtons.includes( element ) )
   {
      element.removeFrom( selectedButtons ).classList.remove( "activeButton" );
   }
   else
   {
      if ( !dualSelection )
      {
         while ( selectedButtons.length > 0 )
         {
            selectedButtons.shift().classList.remove( "activeButton" );
         }
      }
      else if ( selectedButtons.length > 1 )
      {
         selectedButtons.shift().classList.remove( "activeButton" );        
      }

      element.pushTo( selectedButtons ).classList.add( "activeButton" );
   }
}

function init()
{
   let selectedButtons = [];

   let controlBar = createElement( "div",{id:"controlBar"} );
   let comparisonContainer = createElement( "div",{id:"comparisonContainer"} );

   let radioSingleSelection = createElement( "input" ,{ type:"radio", name:"selectMode" });
   let radioDualSelection = createElement( "input" ,{ type:"radio", checked:"checked", name:"selectMode" });
   let checkboxOnlyEffectiveResults = createElement( "input" ,{ type:"checkbox", checked:"checked" });

   checkboxOnlyEffectiveResults.onclick = function(e)
   {
      comparisonContainer.innerHTML = "";
      if ( selectedButtons.length )
      {
         comparisonContainer.appendChild( createComparison( selectedButtons.map(function(b){ return b.pokemonType }),
                                                            checkboxOnlyEffectiveResults.checked ) );
      }
   }

   for ( t in Types )
   {
      let ctrl = createTypeIcon( Types[t] );
      ctrl.classList.add( "controlButton" );
      ctrl.onclick = function(e)
      {
         updateButtons( selectedButtons, e, radioDualSelection.checked );
         comparisonContainer.innerHTML = "";
         if ( selectedButtons.length )
         {
            comparisonContainer.appendChild( createComparison( selectedButtons.map(function(b){ return b.pokemonType }),
                                                               checkboxOnlyEffectiveResults.checked ) );
         }
      };
      controlBar.appendChild( ctrl );
   }

   controlBar.appendChild( radioSingleSelection );
   controlBar.appendChild( createElement( "text", { innerHTML:"single" }));
   controlBar.appendChild( radioDualSelection );
   controlBar.appendChild( createElement( "text", { innerHTML:"dual" }));
   controlBar.appendChild( checkboxOnlyEffectiveResults );
   controlBar.appendChild( createElement( "text", { innerHTML:"effective" }));

   document.body.appendChild( controlBar );
   document.body.appendChild( comparisonContainer );
}


</script>
<style>
body {
   background-color: #eee;
}
#comparisonContainer {
   width: 100%;
   text-align: center;
   margin-top: 20px;
   background-color: #fff;
}
#innerComparisonContainer {
   margin: 0; padding: 0;
}
.typeIcon {
   display: inline-block;
   color: white;
   font-size: 25px;
   margin: 4px;
   padding: 8px;
   text-shadow:
   -2px 2px 2px black,
   2px 2px 2px black,
   2px -2px 2px black,
	-2px -2px 2px black;
}
.controlButton {
   cursor: pointer;
}
.activeButton {
   border: 5px dashed white;
}
.comparisonLine{
   display: block;
   text-align: right;
}
.comparisonLineSpacer{
   display: inline-block;
   padding: 4px;
}
.comparisonLineIcon{
   display: inline-block;
   padding: 4px;
}
.comparisonLineEfficiency{
   display: inline-block;
   padding: 4px;
   width: 2em;
   font-weight: bold;
}
.comparisonBox{
   display: inline-block;
   vertical-align: middle;
}
.comparisonSpacerBox{
   display: inline-block;
   padding: 10px;
}
.bug {      background-color: #a8b820; }
.dark {     background-color: #705848; }
.dragon {   background-color: #7038f8; }
.electric { background-color: #f8d030; }
.fairy {    background-color: #68a090; }
.fighting { background-color: #bd2f27; }
.fire {     background-color: #f08030; }
.flying {   background-color: #a890f0; }
.ghost {    background-color: #705898; }
.grass {    background-color: #78c850; }
.ground {   background-color: #e0c068; }
.ice {      background-color: #98d8d8; }
.normal {   background-color: #a8a878; }
.poison {   background-color: #a040a0; }
.psychic {  background-color: #f85888; }
.rock {     background-color: #b8a038; }
.steel {    background-color: #b8b8d0; }
.water {    background-color: #6890f0; }
</style>
</head>
<body onload="init()"></body>
</html>
